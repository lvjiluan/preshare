<extend name="Common/base"/>
<block name="style">
    <link rel="stylesheet" type="text/css" href="__HR__/css/creatResume.css"/>
</block>
<block name="body">
<div class="container">
    <div class="cr_container">
        <div class="addresume">
            <input type="button" class="inputbutton" value="+ 发布悬赏">
        </div>
        <div class="content">
            <form id="orderForm" action="__ACTION__" method="post" class="ajaxForm">
            <div class="cr_pack1">
                <ul>
                    <li>
                        <span class="pack_name">
                            *悬赏方式:
                        </span>
                        <span class="pack_info">
                            <select class="ages" name="is_fee" id="is_fee">
                                <option value="1">赏金发布</option>
                                <option value="0">免费发布</option>
                            </select>
                            <span style="color: red;">&nbsp;&nbsp;免费次数剩余&nbsp;{$free_number}</span>
                        </span>
                    </li>
                    <li class="need_hidden">
                        <span class="pack_name">
                            *单人赏金:
                        </span>
                        <span class="pack_info">
                            <input class="inputtext1" placeholder="请输入单人赏金" value="{$info['commission']}" name="commission" />
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            *悬赏人数:
                        </span>
                        <span class="pack_info">
                            <input class="inputtext1" placeholder="请输入悬赏人数" value="{$info['recruit_num']}" name="recruit_num" />
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            *职位方向:
                        </span>
                        <span class="pack_info">
                           <select class="ages" name="industry_id" id="industry_id">
                               <option value="">请选择行业</option>
                                <foreach name="industry" item="v">
                                    <option value="{$v['id']}">{$v['industry_name']}</option>
                                </foreach>
                           </select>
                            <script type="text/javascript">
                                        $(function(){
                                            if(parseInt({$info['industry_id']}) > 0){
                                                $('#industry_id').val({$info['industry_id']});
                                            }
                                        });
                            </script>
                            <select class="ages" name="parent_id" id="parent_id"></select>
                            <select class="ages" name="position_id" id="position_id"></select>
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            *最低薪资:
                        </span>
                        <span class="pack_info">
                            <input class="inputtext1" placeholder="请输入最低薪资" value="{$info['base_pay']}" name="base_pay" />
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            *最高工资:
                        </span>
                        <span class="pack_info">
                            <input class="inputtext1" placeholder="请输入最高工资" value="{$info['merit_pay']}" name="merit_pay" />
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            工作年限:
                        </span>
                    <span class="pack_info">
                            <select name="experience" id="experience" class="ages">
                                <option value=""></option>
                                <foreach name="recruit_data.experience" item="v">
                                    <option value="{$v['id']}" <if condition="$info.experience eq $v['id']">selected</if>>{$v['value']}</option>
                                </foreach>
                            </select>
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            工作性质:
                        </span>
                        <span class="pack_info">
                            <select name="nature" id="nature" class="ages">
                                <option value="">选择工作性质</option>
                                <foreach name="recruit_data.nature" item="v">
                                    <option value="{$v['value']}" <if condition="$info.nature eq $v['value']">selected</if>>{$v['value']}</option>
                                </foreach>
                            </select>
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            年&#12288;&#12288;龄:
                        </span>
                        <span class="pack_info">
                            <select class="ages" name="age" id="age">
                                    <option value="">请选择年龄</option>
                                    <foreach name="recruit_data.age" item="v">
                                        <option value="{$v['value']}" <if condition="$info.age eq $v['value']">selected</if>>{$v['value']}</option>
                                    </foreach>
                            </select>

                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            性&#12288;&#12288;别:
                        </span>
                        <span class="pack_info">
                            <select name="sex" id="sex" class="ages">
                                <option value="0">请选择</option>
                                <foreach name="recruit_data.sex" item="v">
                                    <option value="{$v['id']}"  <if condition="$info.sex eq $v['id']">selected</if>>{$v['value']}</option>
                                </foreach>
                            </select>
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            学&#12288;&#12288;历:
                        </span>
                        <span class="pack_info">
                            <select name="degree" id="degree" class="ages">
                                <option value="">请选择学历</option>
                                <foreach name="recruit_data.degree" item="v">
                                    <option value="{$v['id']}" <if condition="$v.id eq $info['degree']">selected</if>>{$v['education_name']}</option>
                                </foreach>
                            </select>
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            *语言能力:
                        </span>
                        <span class="pack_info language">
                            <foreach name="recruit_data.lang" item="v">
                                <span <if condition="$v['sel'] eq 1">class="lanactive"</if>>{$v['value']}</span>
                        </foreach>
                        </span>
                        <input type="hidden" value="{$info['language_ability']}" id="language_ability" name="language_ability" />
                    </li>
                    <li>
                        <span class="pack_name">
                            *福利待遇:
                        </span>
                        <span class="pack_info welfare">
                            <foreach name="recruit_data.tags" item="v">
                                <span <if condition="$v['sel'] eq 1">class="lanactive"</if>>{$v['tags_name']}</span>
                        </foreach>
                        </span>
                        <input type="hidden" value="{$info['welfare']}" id="welfare" name="welfare" />
                    </li>
                    <li>
                        <span class="pack_name">
                            *工作地区:
                        </span>
                        <span class="pack_info" id="start_address">
                            <select class="ages" name="province"></select>
                            <select name="city" class="ages"></select>
                            <select name="county" class="ages"></select>
                        </span>
                    </li>
                    <li>
                        <span class="pack_name">
                            *工作描述:
                        </span>
                        <span class="pack_info">
                            <script id="content1" name="description" type="text/plain">{$info["description"]|htmlspecialchars_decode}</script>
                        </span>
                    </li>
                    <input type="hidden" id="resume_id_class" name="resume_id" value="{$info['id']}">
                    <input type="hidden" id="free_number" name="free_number" value="{$free_number}">
                </ul>
                <input type="submit" class="keepbutton" value="发布悬赏">
                <input type="button" style="cursor: pointer; background: #F9CC9D;color: white;font-size: 16px; width: 172px; height: 44px;border: none;border-radius: 4px;margin-left: 50px;" onclick="goback1()" value="返回">
            </div>
        </form>
        </div>
    </div>
</div>
</block>
<block name="script">
<script type="text/javascript" src="__PUBLIC__/fileupload/js/vendor/jquery.ui.widget.js"></script>
<script type="text/javascript" src="__PUBLIC__/fileupload/js/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="__PUBLIC__/fileupload/js/jquery.fileupload.js"></script>
<script type="text/javascript" src="__ADMIN__/layDate-v5.0.9/laydate/laydate.js"></script>
<script type="text/javascript" src="__STATIC__/js/address.js"></script>
<script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript">
    function callback(data){
        toastr(data.info);
        if(data.status == 1){
            location.href='/index.php/NewHr/Recruit/recruitList';
        }
        if(data.status == 2){
            setTimeout(recruit_pay, 2000);
        }
    }
    var ue = UE.getEditor('content1', {
        autoHeightEnabled: false,
        initialFrameWidth: 800,
        initialFrameHeight: 350
    });
    function goback1(){
        location.href='/index.php/NewHr/Recruit/recruitList';
    }
    function recruit_pay(){
        location.href='/index.php/NewHr/UserAccount/getAccount';
    }
    $(function() {
        $('#is_fee').change(function(){
            var current_fee = $(this).val();
            var free_number = {$free_number};
            if(free_number == 0 && current_fee == 0){
                toastr('免费次数已用光');
                $('#is_fee').val(1);
                return false;
            }
            if(current_fee == 0){
                $('.need_hidden').hide();
            }
            if(current_fee == 1){
                $('.need_hidden').show();
            }
        });
        initAddress('#start_address',"{$info['job_area1']}", "{$info['job_area2']}", "{$info['job_area3']}", 1);
        initPosition({$info['industry_id']});
        $('#industry_id').change(function(){
            initPosition($(this).val());
        });
        $(".language span").click(function(){
            var active_has = $(this).hasClass('lanactive');
            if(true === active_has){
                $(this).removeClass('lanactive');
            }
            else{
                $(this).addClass("lanactive");
            }
            var string = '';
            $(".language span").each(function(i, e){
                var has_class = $(e).hasClass('lanactive');
                if(true === has_class){
                    if('' !== string){
                        string += ',' + $(e).text();
                    }
                    else{
                        string = $(e).text();
                    }
                }
            });
            $('#language_ability').val(string);
        });
        $(".welfare span").click(function(){
            var active_has = $(this).hasClass('lanactive');
            if(true === active_has){
                $(this).removeClass('lanactive');
            }
            else{
                $(this).addClass("lanactive");
            }
            var string = '';
            $(".welfare span").each(function(i, e){
                var has_class = $(e).hasClass('lanactive');
                if(true === has_class){
                    if('' !== string){
                        string += ',' + $(e).text();
                    }
                    else{
                        string = $(e).text();
                    }
                }
            });
            $('#welfare').val(string);
        });
        function initPosition(industry_id){
            if(industry_id > 0){
                $.post("/index.php/NewHr/Position/getPositionList", {industry_id: industry_id}, function (data) {
                    $('#parent_id').html('<option data-id="0" value="0">一级菜单</option>');
                    var dataLen = data.data.length;
                    var parent_sel = 0;
                    for (var i = 0; i < dataLen; i++) {
                        if({$info['position_parent']} > 0 && data.data[i].id == {$info['position_parent']}){
                            parent_sel = 'selected';
                        }
                        else{
                            parent_sel = '';
                        }
                        $('#parent_id').append('<option data-id="' + data.data[i].id
                            + '" value="' + data.data[i].id + '" '+parent_sel+'>'
                            + data.data[i].position_name + '</option>');
                    }
                    initPositionChildren({$info['position_parent']});
                });
            }
        }

        $('#parent_id').change(function(){
            initPositionChildren($(this).val());
        });

        function initPositionChildren(position_id){
            if(position_id > 0){
                $.post("/index.php/NewHr/Position/getPositionChildrenList", {position_id: position_id}, function (data) {
                    $('#position_id').html('<option data-id="0" value="">请选择</option>');
                    var dataLen = data.data.length;
                    var parent_sel = '';
                    for (var i = 0; i < dataLen; i++) {
                        if(data.data[i].id == {$info['position_id']}){
                            parent_sel = 'selected';
                        }
                        else{
                            parent_sel = '';
                        }
                        $('#position_id').append('<option data-id="' + data.data[i].id
                            + '" value="' + data.data[i].id + '" '+parent_sel+'>'
                            + data.data[i].position_name + '</option>');
                    }
                });
            }
        }
    });
</script>
</block>